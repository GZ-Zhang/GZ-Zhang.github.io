{"title":"git问题记录","uid":"977fdc579da19a42e22c99bb8addfd6a","slug":"Linux/Linux排查进程和IP占用网速","date":"2022-11-26T15:26:08.000Z","updated":"2022-11-26T16:20:43.889Z","comments":true,"path":"api/articles/Linux/Linux排查进程和IP占用网速.json","keywords":null,"cover":"/medias/Linux排查进程和IP占用网速.png","content":"<h1 id=\"Linux排查进程和IP占用网速\"><a href=\"#Linux排查进程和IP占用网速\" class=\"headerlink\" title=\"Linux排查进程和IP占用网速\"></a>Linux排查进程和IP占用网速</h1><h2 id=\"1-测试互联网网络环境\"><a href=\"#1-测试互联网网络环境\" class=\"headerlink\" title=\"1.测试互联网网络环境\"></a>1.测试互联网网络环境</h2><p><strong>使用speedtest-cli命令。</strong></p>\n<ol>\n<li><p>安装speedtest-cli</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">yum  –y install python-pip \n\npip install speedtest-cli</code></pre></li>\n<li><p>测试带宽</p>\n<p><img src=\"/post/Linux/Linux%E6%8E%92%E6%9F%A5%E8%BF%9B%E7%A8%8B%E5%92%8CIP%E5%8D%A0%E7%94%A8%E7%BD%91%E9%80%9F/image-20221126002859411.png\" alt=\"image-20221126002859411\"></p>\n</li>\n</ol>\n<h2 id=\"2-查看网卡，网络情况\"><a href=\"#2-查看网卡，网络情况\" class=\"headerlink\" title=\"2.查看网卡，网络情况\"></a>2.<strong>查看网卡，网络情况</strong></h2><ol>\n<li>使用nload命令查看</li>\n</ol>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">yum -y install nload\n\n#查看eth0网卡网络情况\nnload eth0</code></pre>\n\n<p><img src=\"/post/Linux/Linux%E6%8E%92%E6%9F%A5%E8%BF%9B%E7%A8%8B%E5%92%8CIP%E5%8D%A0%E7%94%A8%E7%BD%91%E9%80%9F/image-20221126003324943.png\" alt=\"image-20221126003324943\"></p>\n<p>Incoming也就是进入网卡的流量，Outgoing，也就是从这块网卡出去的流量，每一部分都有下面几个。</p>\n<p>– Curr：当前流量<br>– Avg：平均流量<br>– Min：最小流量<br>– Max：最大流量<br>– Ttl：总流量<br>nload默认的是eth0网卡，如果你想监测eth1网卡的流量，可以使用下面的命令</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">nload -m</code></pre>\n\n<p><img src=\"/post/Linux/Linux%E6%8E%92%E6%9F%A5%E8%BF%9B%E7%A8%8B%E5%92%8CIP%E5%8D%A0%E7%94%A8%E7%BD%91%E9%80%9F/image-20221126003448274.png\" alt=\"image-20221126003448274\"></p>\n<h2 id=\"3-使用iftop定位哪个IP在占用流量\"><a href=\"#3-使用iftop定位哪个IP在占用流量\" class=\"headerlink\" title=\"3.使用iftop定位哪个IP在占用流量\"></a>3.使用iftop定位哪个IP在占用流量</h2><h3 id=\"查看哪个连接占用流量最多\"><a href=\"#查看哪个连接占用流量最多\" class=\"headerlink\" title=\"查看哪个连接占用流量最多\"></a>查看哪个连接占用流量最多</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">yum -y install iftop\n\n# 查看eth0哪个连接网络流量最多\niftop -P\n\n#不解析域名,所有的网络连接都以ip显示\niftop -n\n\n# 不加i参数表示监控所有网卡\niftop\n\n# 指定网卡且不解析dns\niftop -n -i eth0 \n\n# 查看流量较高的是占用的端口(或服务)\niftop -i eth0 -P\n\n# -N查看流量较高的是占用的端口\niftop -i eth0 -P -N\n</code></pre>\n\n\n\n<p><img src=\"/post/Linux/Linux%E6%8E%92%E6%9F%A5%E8%BF%9B%E7%A8%8B%E5%92%8CIP%E5%8D%A0%E7%94%A8%E7%BD%91%E9%80%9F/image-20221126003631026.png\" alt=\"image-20221126003631026\"></p>\n<p>1、界面信息<br>安装完 iftop 工具后，直接输入 iftop 命令即可显示网卡实时流量信息。在默认情况下，iftop 显示系统第一块网卡的流量信息，如果要显示指定网卡信息，可通过“-i”参数实现。执行“iftop -P -i eth0”命令，得到如下图所示的 iftop 的一个典型输出界面。</p>\n<ul>\n<li>第一部分<br>iftop 输出中最上面的一行，此行信息是流量刻度，用于显示网卡带宽流量。</li>\n<li>第二部分<br>此部分为分割线中间的部分，其中又分别分为左、中、右三列。左列和中列，记录了哪些 IP 或主机正在和本机的网络进行连接。其中，中列的“=&gt;”代表发送数据，“&lt;=”代表接收数据，通过这个指示箭头可以很清晰地知道两个 IP 之间的通信情况。最右列又分为三小列，这些实时参数分别表示外部 IP 连接到本机 2 秒内、10 秒内和 40 秒内的平均流量值。<br>另外，这个部分还有一个流量图形条，流量图形条是对流量大小的动态展示，以第一部分中的流量刻度为基准。通过这个流量图形条可以很方便地看出哪个 IP 的流量最大，进而迅速定位网络中可能出现的流量问题。</li>\n<li>第三部分<br>位于 iftop 输出的最下面，可以分为三行，其中，“TX”表示发送数据，“RX”表示接收数据，“TOTAL”表示发送和接收全部流量。与这三行对应的有三列，其中“cum”列表示从运行 iftop 到目前的发送、接收和总数据流量。“peak”列表示发送、接收以及总的流量峰值。“rates”列表示过去 2s、10s、40s 的平均流量值。</li>\n</ul>\n<h2 id=\"4-使用NetHogs定位哪个进程在占用流量\"><a href=\"#4-使用NetHogs定位哪个进程在占用流量\" class=\"headerlink\" title=\"4.使用NetHogs定位哪个进程在占用流量\"></a>4.使用NetHogs定位哪个进程在占用流量</h2><p><strong>使用nethogs命令查看各个进程使用网络的情况</strong></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 安装NetHogs。\nyum  -y  install nethogs\n \n# 执行以下命令，查看占用内网带宽的进程。\nnethogs\n\n# 查询间隔(-d)5秒\nnethogs eth1 -d 5</code></pre>\n\n<p><img src=\"/post/Linux/Linux%E6%8E%92%E6%9F%A5%E8%BF%9B%E7%A8%8B%E5%92%8CIP%E5%8D%A0%E7%94%A8%E7%BD%91%E9%80%9F/image-20221126004325363.png\" alt=\"image-20221126004325363\"></p>\n<h3 id=\"显示界面说明\"><a href=\"#显示界面说明\" class=\"headerlink\" title=\"显示界面说明\"></a>显示界面说明</h3><p>在nethogs监控界面，按s可以按照Sent列进行排序，按r可以按照Received列进行排序，按m可以切换不同的统计单位显示，例如kb/s、kb、b、mb。监控界面信息说明如下所示。</p>\n<ul>\n<li>PID列表示相应流量关联程序的进程号。</li>\n<li>USER列表示相应进程的所属用户。</li>\n<li>PROGRAM列表示程序的具体执行路径。</li>\n<li>DEV列当前监控的网络接口名称。</li>\n<li>Sent列表示相应进程已经发送的数据流量。</li>\n<li>Received列表示程序已经接收的数据流量。</li>\n</ul>\n<h2 id=\"5-快速端口占用的pid\"><a href=\"#5-快速端口占用的pid\" class=\"headerlink\" title=\"5.快速端口占用的pid\"></a>5.快速端口占用的pid</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 使用fuser定位端口的pid\nfuser -v  -n tcp 3306\n\n结束掉占用的pid\nkill -s 9 pid\n</code></pre>\n\n<h3 id=\"使用lsof定位端口的pid\"><a href=\"#使用lsof定位端口的pid\" class=\"headerlink\" title=\"使用lsof定位端口的pid\"></a>使用lsof定位端口的pid</h3><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>参考: <a href=\"https://blog.csdn.net/flower_vip/article/details/80481258\">https://blog.csdn.net/flower_vip/article/details/80481258</a></p></blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">lsof -i:端口号\n\n[greg@node5 ~]$ sudo lsof -i:80\nCOMMAND  PID    USER   FD   TYPE DEVICE SIZE&#x2F;OFF NODE NAME\nhaproxy 9521 haproxy    9u  IPv4  63613      0t0  TCP *:http (LISTEN)\n\n\n##  -n 不要将端口号转换为端口名称。\n## -P 不解析主机名，显示数字地址。\n## -iTCP -sTCP:LISTEN -仅显示TCP状态为LISTEN的网络文件\n\n# 查看TCP22端口是哪个进程占用\nsudo lsof -nP -iTCP:22 -sTCP:LISTEN\n# 查看监听的所有TCP端口\nsudo lsof -nP -iTCP -sTCP:LISTEN\n</code></pre>\n\n<h3 id=\"通过PID进程号查找启动程序全路径\"><a href=\"#通过PID进程号查找启动程序全路径\" class=\"headerlink\" title=\"通过PID进程号查找启动程序全路径\"></a>通过PID进程号查找启动程序全路径</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">ls -ail &#x2F;proc&#x2F;pid进程号</code></pre>\n\n<ul>\n<li><code>cwd</code>是该进程的工作目录</li>\n<li><code>exe</code>是启程序的启动路径</li>\n<li><code>fd</code>包含进程打开文件的情况</li>\n</ul>\n<h2 id=\"结束进程\"><a href=\"#结束进程\" class=\"headerlink\" title=\"结束进程\"></a>结束进程</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 停止进程\nkill -15 pid号\n或\n# 强制结束进程\nkill -9 pid号</code></pre>\n\n<h2 id=\"日志分析\"><a href=\"#日志分析\" class=\"headerlink\" title=\"日志分析\"></a>日志分析</h2><p>日志分析可以使用<code>logwatch</code>或<code>awstats</code>等工具进行.</p>\n<p>参考链接：</p>\n<p><a href=\"https://blog.csdn.net/qq_22537727/article/details/122728663\">https://blog.csdn.net/qq_22537727/article/details/122728663</a></p>\n<p>[Linux排查哪个进程和IP在占用网速]<a href=\"https://blog.csdn.net/omaidb/article/details/120691692\">https://blog.csdn.net/omaidb/article/details/120691692</a></p>\n","feature":true,"text":"Linux排查进程和IP占用网速1.测试互联网网络环境使用speedtest-cli命令。 安装speedtest-cli yum –y install python-pip pip install speedtest-cli 测试带宽 2.查看网卡，网络情况 使用nload命令...","link":"","photos":[],"count_time":{"symbolsCount":"2.5k","symbolsTime":"2 mins."},"categories":[{"name":"linux","slug":"linux","count":1,"path":"api/categories/linux.json"}],"tags":[{"name":"linux","slug":"linux","count":1,"path":"api/tags/linux.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Linux%E6%8E%92%E6%9F%A5%E8%BF%9B%E7%A8%8B%E5%92%8CIP%E5%8D%A0%E7%94%A8%E7%BD%91%E9%80%9F\"><span class=\"toc-text\">Linux排查进程和IP占用网速</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-%E6%B5%8B%E8%AF%95%E4%BA%92%E8%81%94%E7%BD%91%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83\"><span class=\"toc-text\">1.测试互联网网络环境</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2-%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%EF%BC%8C%E7%BD%91%E7%BB%9C%E6%83%85%E5%86%B5\"><span class=\"toc-text\">2.查看网卡，网络情况</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-%E4%BD%BF%E7%94%A8iftop%E5%AE%9A%E4%BD%8D%E5%93%AA%E4%B8%AAIP%E5%9C%A8%E5%8D%A0%E7%94%A8%E6%B5%81%E9%87%8F\"><span class=\"toc-text\">3.使用iftop定位哪个IP在占用流量</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8B%E5%93%AA%E4%B8%AA%E8%BF%9E%E6%8E%A5%E5%8D%A0%E7%94%A8%E6%B5%81%E9%87%8F%E6%9C%80%E5%A4%9A\"><span class=\"toc-text\">查看哪个连接占用流量最多</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-%E4%BD%BF%E7%94%A8NetHogs%E5%AE%9A%E4%BD%8D%E5%93%AA%E4%B8%AA%E8%BF%9B%E7%A8%8B%E5%9C%A8%E5%8D%A0%E7%94%A8%E6%B5%81%E9%87%8F\"><span class=\"toc-text\">4.使用NetHogs定位哪个进程在占用流量</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%98%BE%E7%A4%BA%E7%95%8C%E9%9D%A2%E8%AF%B4%E6%98%8E\"><span class=\"toc-text\">显示界面说明</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5-%E5%BF%AB%E9%80%9F%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E7%9A%84pid\"><span class=\"toc-text\">5.快速端口占用的pid</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8lsof%E5%AE%9A%E4%BD%8D%E7%AB%AF%E5%8F%A3%E7%9A%84pid\"><span class=\"toc-text\">使用lsof定位端口的pid</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%80%9A%E8%BF%87PID%E8%BF%9B%E7%A8%8B%E5%8F%B7%E6%9F%A5%E6%89%BE%E5%90%AF%E5%8A%A8%E7%A8%8B%E5%BA%8F%E5%85%A8%E8%B7%AF%E5%BE%84\"><span class=\"toc-text\">通过PID进程号查找启动程序全路径</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%BB%93%E6%9D%9F%E8%BF%9B%E7%A8%8B\"><span class=\"toc-text\">结束进程</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90\"><span class=\"toc-text\">日志分析</span></a></li></ol></li></ol>","author":{"name":"Guzong","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"开发说那不是Bug还打了我","socials":{"github":"https://github.com/GZ-Zhang","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/qq_35536689","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://www.bilibili.com/"}}}},"mapped":true,"prev_post":{},"next_post":{"title":"Hexo+Aurora 文章设置封面图片(banner)","uid":"ee989d82af440ba37d78b317fae98d17","slug":"Hexo+Aurora 文章设置封面图片(banner)","date":"2022-11-25T15:55:51.000Z","updated":"2022-11-26T16:20:12.821Z","comments":true,"path":"api/articles/Hexo+Aurora 文章设置封面图片(banner).json","keywords":null,"cover":[],"text":"Hexo+Aurora 文章设置封面图片(banner)背景最近在编写hexo博客，在网上查询一直得不到想要答案，最后通过贴吧发现正确答案，记录一下。解决办法选择在source文件夹下创建一个medias文件夹，然后里面放入图片，在cover选项下: /img/图片名字，就可以引...","link":"","photos":[],"count_time":{"symbolsCount":271,"symbolsTime":"1 mins."},"categories":[{"name":"Hexo","slug":"Hexo","count":3,"path":"api/categories/Hexo.json"}],"tags":[{"name":"Hexo","slug":"Hexo","count":3,"path":"api/tags/Hexo.json"}],"author":{"name":"Guzong","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"开发说那不是Bug还打了我","socials":{"github":"https://github.com/GZ-Zhang","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/qq_35536689","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://www.bilibili.com/"}}}},"feature":true}}